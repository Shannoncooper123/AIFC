# BB+RSI é‡‘å­—å¡”è§„åˆ™äº¤æ˜“ç­–ç•¥ - ä½¿ç”¨æŒ‡å—

## ğŸ“– ç®€ä»‹

åŸºäºå›æµ‹æœ€ä¼˜å‚æ•°çš„è‡ªåŠ¨äº¤æ˜“ç­–ç•¥ï¼š
- **ç­–ç•¥ç±»å‹**: BB+RSI æŠ„åº• + 2å±‚é‡‘å­—å¡”åŠ ä»“
- **æœ€ä¼˜å‚æ•°**: TP/SL 3.0:3.0, 4å°æ—¶æ—¶é—´é™åˆ¶
- **ä»“ä½ç®¡ç†**: æ¯å¸ç§10%æ€»èµ„é‡‘ï¼Œåˆ†ä¸¤æ¬¡å…¥åœºï¼ˆ5% + 5%ï¼‰

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯ç”¨ç­–ç•¥

ç¼–è¾‘ `config.yaml`:
```yaml
rule_strategy:
  enabled: true  # æ”¹ä¸º true
```

### 2. å¯åŠ¨ç­–ç•¥

```bash
cd /home/sunfayao/monitor
python -m agent.rule_strategy.main
```

### 3. ç›‘æ§è¿è¡Œ

ç­–ç•¥ä¼šè‡ªåŠ¨ï¼š
- è¯»å– `data/rule_alerts.jsonl` ä¸­çš„ä¿¡å·
- æ‰§è¡Œé‡‘å­—å¡”äº¤æ˜“
- çŠ¶æ€ä¿å­˜åœ¨ `agent/trade_state.json`
- å†å²ä¿å­˜åœ¨ `logs/position_history.json`

---

## âš™ï¸ é…ç½®è¯´æ˜

### æ ¸å¿ƒå‚æ•°ï¼ˆ`config.yaml` ä¸­çš„ `rule_strategy` èŠ‚ï¼‰

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `enabled` | `false` | æ˜¯å¦å¯ç”¨ç­–ç•¥ |
| `entry.rsi_entry` | `40` | Level 1 å…¥åœº RSI é˜ˆå€¼ |
| `entry.rsi_addon` | `30` | Level 2 åŠ ä»“ RSI é˜ˆå€¼ |
| `pyramid.levels` | `2` | é‡‘å­—å¡”å±‚æ•° |
| `pyramid.position_sizes` | `[0.5, 0.5]` | æ¯å±‚ä»“ä½æ¯”ä¾‹ |
| `pyramid.addon_atr_drop` | `0.5` | åŠ ä»“è§¦å‘ï¼šä»·æ ¼ä¸‹è·Œ ATR å€æ•° |
| `tp_sl.tp_atr_multiplier` | `3.0` | æ­¢ç›ˆ ATR å€æ•° |
| `tp_sl.sl_atr_multiplier` | `3.0` | æ­¢æŸ ATR å€æ•° |
| `time_limit.bars` | `16` | æœ€å¤§æŒä»“æ—¶é—´ï¼ˆKçº¿æ•°ï¼‰ |
| `position.max_position_pct` | `0.10` | æ¯å¸ç§æœ€å¤§ä»“ä½ï¼ˆæ€»èµ„é‡‘10%ï¼‰ |
| `position.leverage` | `10` | æ æ†å€æ•° |

---

## ğŸ“Š äº¤æ˜“é€»è¾‘

### Level 1 å…¥åœº
**è§¦å‘æ¡ä»¶**:
- RSI < 40
- Close < BBä¸‹è½¨

**åŠ¨ä½œ**:
- å¼€ä»“ï¼šæ€»èµ„é‡‘çš„5%ï¼ˆ10% Ã— 50%ï¼‰
- è®¾ç½® TP = å…¥åœºä»· + 3.0Ã—ATR
- è®¾ç½® SL = å…¥åœºä»· - 3.0Ã—ATR

### Level 2 åŠ ä»“
**è§¦å‘æ¡ä»¶**:
- å·²æœ‰ Level 1 ä»“ä½
- RSI < 30ï¼ˆæ›´æ·±åº¦è¶…å–ï¼‰
- ä»·æ ¼æ¯” Level 1 ä½ 0.5Ã—ATR

**åŠ¨ä½œ**:
- åŠ ä»“ï¼šæ€»èµ„é‡‘çš„5%ï¼ˆ10% Ã— 50%ï¼‰
- é‡æ–°è®¡ç®—å‡ä»· = (L1ä»·æ ¼ + L2ä»·æ ¼) / 2
- æ›´æ–° TP = å‡ä»· + 3.0Ã—ATR
- æ›´æ–° SL = å‡ä»· - 3.0Ã—ATR

### æ—¶é—´é™åˆ¶å¹³ä»“
**è§¦å‘æ¡ä»¶**:
- æŒä»“æ—¶é—´è¶…è¿‡ 16æ ¹15åˆ†é’ŸKçº¿ï¼ˆ4å°æ—¶ï¼‰

**åŠ¨ä½œ**:
- è‡ªåŠ¨å¹³ä»“æ‰€æœ‰è¯¥å¸ç§çš„æŒä»“

---

## ğŸ“ æ–‡ä»¶ç»“æ„

```
monitor/
â”œâ”€â”€ agent/rule_strategy/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                    # ä¸»å…¥å£
â”‚   â”œâ”€â”€ strategy_executor.py       # ç­–ç•¥æ‰§è¡Œå™¨
â”‚   â””â”€â”€ pyramid_manager.py         # é‡‘å­—å¡”ç®¡ç†å™¨
â”œâ”€â”€ data/
â”‚   â””â”€â”€ rule_alerts.jsonl          # ä¿¡å·æ–‡ä»¶ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ agent/
â”‚   â””â”€â”€ trade_state.json           # æŒä»“çŠ¶æ€ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
â””â”€â”€ logs/
    â””â”€â”€ position_history.json      # å†å²è®°å½•ï¼ˆè‡ªåŠ¨æ›´æ–°ï¼‰
```

---

## ğŸ” ç›‘æ§ä¸æ—¥å¿—

### æŸ¥çœ‹è¿è¡Œæ—¥å¿—
```bash
tail -f logs/rule_strategy.log
```

### æŸ¥çœ‹å®æ—¶ä¿¡å·
```bash
tail -f data/rule_alerts.jsonl
```

### æŸ¥çœ‹æŒä»“çŠ¶æ€
```bash
cat agent/trade_state.json | jq
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **èµ„é‡‘ç®¡ç†**: ç¡®ä¿ `agent.simulator.initial_balance` è¶³å¤Ÿï¼ˆå»ºè®® â‰¥ 500 USDTï¼‰
2. **å¸ç§æ•°é‡**: æœ€å¤šåŒæ—¶æŒä»“ 10 ä¸ªå¸ç§ï¼ˆ10% Ã— 10 = 100%ï¼‰
3. **æ—¶é—´é™åˆ¶**: 4å°æ—¶å¼ºåˆ¶å¹³ä»“ï¼Œé¿å…æ­»æ‰›
4. **é£é™©æ§åˆ¶**: æ¯ä¸ªå¸ç§æœ€å¤§æŸå¤± = 10% Ã— 3.0 ATR Ã— æ æ†

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### é—®é¢˜: ç­–ç•¥ä¸æ‰§è¡Œäº¤æ˜“
**æ£€æŸ¥**:
1. `config.yaml` ä¸­ `rule_strategy.enabled` æ˜¯å¦ä¸º `true`
2. `data/rule_alerts.jsonl` æ˜¯å¦æœ‰æ–°ä¿¡å·
3. æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### é—®é¢˜: ä¿¡å·ä¸ç”Ÿæˆ
**æ£€æŸ¥**:
1. monitor ä¸»ç¨‹åºæ˜¯å¦åœ¨è¿è¡Œ
2. `config.yaml` ä¸­ `detection.strategy_type` æ˜¯å¦åŒ…å«è§„åˆ™ç­–ç•¥
3. æ˜¯å¦æœ‰å¸ç§è§¦å‘ RSI < 40 ä¸” Close < BB_Lower

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜è¯·æŸ¥çœ‹: `logs/rule_strategy.log`
